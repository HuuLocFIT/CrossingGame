#include<iostream>
#include<string>
#include<cmath>
#include<fstream>
#include<ctime>
#include<conio.h>
#include<fcntl.h> 
#include<io.h>
#include "windows.h"
#include<thread>

#include"Mylib.h"
#include"GUI.h"
#include"CVEHICLE.h"
#include"CGAME.h"

using namespace std;

=========GUI========
/*GotoXY(71, 13); wcout << "      .---.        .-----------";
	GotoXY(71, 14); wcout << "     /     \\  __  /    ------";
	GotoXY(71, 15); wcout << "    / /     \\(  )/    -----";
	GotoXY(71, 16); wcout << "   //////   ' \\/ `   ---";
	GotoXY(71, 17); wcout << "  //// / // :    : ---";
	GotoXY(71, 18); wcout << " // /   /  /`    '--";
	GotoXY(71, 19); wcout << "//          //..\\\\";
	GotoXY(71, 20); wcout << "       ====UU====UU====";
	GotoXY(71, 21); wcout << "           '//||\\\\`";
	GotoXY(71, 22); wcout << "             ''``";*/

/*GotoXY(20, 14); wcout << "        _______________" << endl;
	GotoXY(20, 15); wcout << "       / / |  |  |  |  \\" << endl;
	GotoXY(20, 16); wcout << " _____/ /  |__|  |__|   \\" << endl;
	GotoXY(20, 17); wcout << "|_|     __        __    |" << endl;
	GotoXY(20, 18); wcout << "|______/  \\______/  \\___|" << endl;
	GotoXY(20, 19); wcout << "       \\__/      \\__/" << endl;*/

void printThankYou(int x, int y) {
	SetColor(10);
	printBox(47, 21, 28, 2);//x + 35, y + 16
	GotoXY(53, 22);  wcout << "Press Esc to Exit";//x + 41, y + 17
	int color = 0;

	while (1) {
		SetColor(color);
		if (color > 15)
			color = 0;

		GotoXY(x, y); wcout << " __________  __    __  ________  __    __  __   ___     ___    ___ ________  __     __    __";
		GotoXY(x, y + 1); wcout << "|___    ___||  |  |  ||   __   ||  \\  |  ||  | /  /     \\  \\  /  /|   __   ||  |   |  |  |  |";
		GotoXY(x, y + 2); wcout << "    |  |    |  |__|  ||  |  |  ||   \\ |  ||  |/  /       \\  \\/  / |  |  |  ||  |   |  |  |  |";
		GotoXY(x, y + 3); wcout << "    |  |    |   __   ||  |__|  ||  |\\\\|  ||     /         \\    /  |  |  |  ||  |   |  |  |__|";
		GotoXY(x, y + 4); wcout << "    |  |    |  |  |  ||  |  |  ||  | \\|  ||  |\\  \\         |  |   |  |__|  ||  |___|  |   __";
		GotoXY(x, y + 5); wcout << "    |__|    |__|  |__||__|  |__||__|  \\__||__| \\__\\        |__|   |________||_________|  |__|";

		if (_kbhit()) {
			char press = _getch();
			if (press == 27) return;
		}
		color++;
		Sleep(1);
	}
}

void printLoading() {
	system("cls");
	ShowCur(0);
	int percent = 10;
	SetColor(7); printBox(17, 15, 81, 2);
	int xOld = 8;
	thread musicCar(MusicCarLoading);
	for (int i = 18; i <= 90; i += 8) {
		SetColor(7); GotoXY(100, 16); wcout << percent << "%";
		textcolor(121); GotoXY(i, 16); wcout << "        ";
		textcolor(0);

		DeleteImageOld(xOld, 11, 10, 4);
		SetColor(3); printCarLoading(i, 11);

		percent += 10;
		xOld += 8;
		Sleep(600);
	}
	musicCar.join();
	wcout << endl << endl << endl;
	textcolor(0);
}

int yMove = 17;//Dùng để di chuyển trên Home page
//Khoi tao cac ham
void printHomePage(int x, int y, int w, int h);

//======================================================================================================

void printAboutUs() {
	SetColor(10);
	printBox(47, 21, 28, 2);
	GotoXY(53, 22);  wcout << "Press Esc to Exit";

	while (1) {
		SetColor(6);
		GotoXY(58, 8); wcout << "MEMBERS";
		GotoXY(50, 10); wcout << "MSSV";
		GotoXY(48, 11); wcout << "20127214";
		GotoXY(48, 12); wcout << "20127233";
		GotoXY(48, 13); wcout << "20127459";
		GotoXY(48, 14); wcout << "20127522";
		GotoXY(48, 15); wcout << "20127551";
		GotoXY(63, 10); wcout << "FULLNAME";
		GotoXY(60, 11); wcout << "Ng~ Truong M.Khoi";
		GotoXY(60, 12); wcout << "Huynh The Long";
		GotoXY(60, 13); wcout << "Le Quoc Dat";
		GotoXY(60, 14); wcout << "Nguyen Huu Khai";
		GotoXY(60, 15); wcout << "Nguyen Huu Loc";

		SetColor(4);
		printBox(45, 6, 32, 11);

		if (_kbhit()) {
			char press = _getch();
			if (press == 27) return;
		}
	}
}

void StartGame() {
	system("cls");
	ShowCur(0);
	printLoading();

	system("cls");
	CGAME *cg = new CGAME();
	SetColor(7);
	cg->drawGame();
	CVEHICLE *v = new CCAR[3];

	//Line 1: Cars
	int yCarLTR = 1;
	int xCarLTR1 = 0;
	int xCarLTROld1 = xCarLTR1;
	int xCarLTR2 = 0;
	int xCarLTROld2 = xCarLTR2;
	int xCarLTR3 = 0;
	int xCarLTROld3 = xCarLTR3;

	CANIMAL* a = new CBAT[3];
	//Line 2: Bats
	int yBat = 6;
	int xBat1 = 66;
	int xBatOld1 = xBat1;
	int xBat2 = 66;
	int xBatOld2 = xBat2;
	int xBat3 = 66;
	int xBatOld3 = xBat3;

	while (1) {
		//Line 1: Cars
		if (xCarLTR1 == 70) 
			xCarLTR1 = 0;
		if (xCarLTR2 == 70)
			xCarLTR2 = 0;
		if (xCarLTR3 == 70)
			xCarLTR3 = 0;
		//Line 2: Bats
		if (xBat1 == 0)
			xBat1 = 66;
		if (xBat2 == 0)
			xBat2 = 66;
		if (xBat3 == 0)
			xBat3 = 66;

		DeleteImageOld(xCarLTROld1, yCarLTR, 10, 4);
		v[0].Move(xCarLTR1, yCarLTR);
		xCarLTROld1 = xCarLTR1;
		xCarLTR1 += 2;

		//Bats
		DeleteImageOld(xBatOld1, yBat, 13, 4);
		a[0].Move(xBat1, yBat);
		xBatOld1 = xBat1;
		xBat1 -= 2;

		//Cars
		if (xCarLTR1 >= 20 || xCarLTR2 >= 20) {
			DeleteImageOld(xCarLTROld2, yCarLTR, 10, 4);
			v[1].Move(xCarLTR2, yCarLTR);
			xCarLTROld2 = xCarLTR2;
			xCarLTR2 += 2;
		}
		if (xCarLTR2 >= 20 || xCarLTR3 >= 20) {
			DeleteImageOld(xCarLTROld3, yCarLTR, 10, 4);
			v[2].Move(xCarLTR3, yCarLTR);
			xCarLTROld3 = xCarLTR3;
			xCarLTR3 += 2;
		}

		//Bats
		if (xBat1 <= 46 || xBat2 <= 46) {
			DeleteImageOld(xBatOld2, yBat, 13, 4);
			a[1].Move(xBat2, yBat);
			xBatOld2 = xBat2;
			xBat2 -= 2;
		}
		if (xBat2 <= 46 || xBat3 <= 46) {
			DeleteImageOld(xBatOld3, yBat, 13, 4);
			a[2].Move(xBat3, yBat);
			xBatOld3 = xBat3;
			xBat3 -= 2;
		}

		Sleep(200);
	}
	/*system("cls");
	SetColor(10);
	printBox(47, 21, 28, 2);
	GotoXY(53, 22);  wcout << "Press Esc to Exit";
	while (1) {
		if (_kbhit()) {
			char press = _getch();
			if (press == 27) return;
		}
		GotoXY(51, 18); wcout << "This is Start Game!";
	}*/
}

void LoadGame() {
	SetColor(10);
	printBox(47, 21, 28, 2);
	GotoXY(53, 22);  wcout << "Press Esc to Exit";
	while (1) {
		if (_kbhit()) {
			char press = _getch();
			if (press == 27) return;
		}
		GotoXY(51, 18); wcout << "This is Load Game!";
	}
}

void printInstructions() {
	SetColor(10);
	printBox(47, 21, 28, 2);
	GotoXY(53, 22);  wcout << "Press Esc to Exit";
	while (1) {
		if (_kbhit()) {
			char press = _getch();
			if (press == 27) return;
		}
		GotoXY(51, 18); wcout << "This is instructions!";
	}
}

//EXIT GAME
void ExitGame() {
	system("cls");
	ShowCur(0);
	printHomePage(15, 1, 90, 25); //In lại Home page
	SetColor(14);
	GotoXY(52, yMove); wcout << L'»';
}

//=============================================== CLASS CVEHICLE ===============================================

//Màn hình chính khi vào game
void printHomePage(int x, int y, int w, int h) {
	//x = 15, y = 1, w = 90, h = 25 
	//x = 171, y = 40

	SetColor(6);
	GotoXY(19, 2); wcout << " _______  _______  _______  _______  _______    _______  _______  _______  ______";
	GotoXY(19, 3); wcout << "|  _____||  ___  ||  ___  ||  _____||  _____|  |  ___  ||  ___  ||  ___  ||  ___ \\";
	GotoXY(19, 4); wcout << "| |      | |___| || |   | || |_____ | |_____   | |___| || |   | || |___| || |   \\ |";
	GotoXY(19, 5); wcout << "| |_____ | |  \\ \\ | |___| | _____| | _____| |  | |  \\ \\ | |___| || |   | || |___/ |";
	GotoXY(19, 6); wcout << "|_______||_|   \\_\\|_______||_______||_______|  |_|   \\_\\|_______||_|   |_||______/";

	SetColor(5);//Mau hong
	for (int i = x; i <= x + w; i++) {
		GotoXY(i, 8); wcout << L'─';
	}

	SetColor(2);//Mau xanh la
	printBigCar(20, 14);

	SetColor(12);//Mau do
	GotoXY(x + 40, 17); wcout << "START GAME";
	GotoXY(x + 40, 18); wcout << "LOAD GAME";
	GotoXY(x + 40, 19); wcout << "INSTRUCTIONS";
	GotoXY(x + 40, 20); wcout << "ABOUT US";
	GotoXY(x + 40, 21); wcout << "EXIT GAME";

	SetColor(1);//Mau xanh duong
	printBigBird(71, 13);

	SetColor(5);//Mau hong
	printBox(x, y, w, h);
}



//Xử lí chính
void MainProgram(int x/*, int y, int w, int h*/) {
	bool press = true;//Kiem tra nguoi dung co an phim nao chua
	int xCur = x + 37; //Toa do x cua mui ten di chuyen tren home page
	int yOld = yMove; //Toa do y cua mui ten di chuyen tren home page
	char move;

	while (1) {
		if (press == true) {//Neu khong co dong lenh nay mui ten se nhay lien tuc vi khi chua duoc bam no van in ra
			//Xoa mui ten di chuyen o vi tri cu 
			GotoXY(xCur, yOld); wcout << " ";
			ShowCur(0);
			SetColor(14);
			GotoXY(x + 37, yMove); wcout << L'»'; //In mui ten moi
			yOld = yMove;//Cap nhat lai vi tri yOld
			press = false;
		}
		//Kiem tra nguoi dung nhan phim de di chuyen
		if (_kbhit()) {
			move = _getch();
			//============================== Di chuyen ==============================
			if (move == -32) {
				press = true;
				move = _getch();
				if (move == 72) {//Di len
					if (yMove > 17)
						yMove--;
					else
						yMove = 21;//Neu di len vuot qua lua chon thi di xuong lua chon cuoi
				}
				else if (move == 80) {//Di xuong
					if (yMove < 21)
						yMove++;
					else
						yMove = 17;//Neu di xuong vuot qua lua chon thi di len lua chon dau
				}
			}
			//============================== Lua chon de thuc thi ==============================
			//Exit
			else if (move == 13 && yMove == 21) {
				system("cls");
				printThankYou(12, 5);
				system("cls");
				break;
			}
			//Start Game
			else if (move == 13 && yMove == 17) {
				system("cls");
				StartGame();
				ExitGame();
			}
			//Load Game
			else if (move == 13 && yMove == 18) {
				system("cls");
				LoadGame();
				ExitGame();
			}
			//Instructions
			else if (move == 13 && yMove == 19) {
				system("cls");
				printInstructions();
				ExitGame();
			}
			//About us
			else if (move == 13 && yMove == 20) {
				system("cls");
				printAboutUs();
				ExitGame();
			}
		}
	}
}


int main() {
	_setmode(_fileno(stdout), _O_WTEXT);
	FixConsoleWindow();
	setConsoleWindown(1780, 700);//x = 171, y = 40

	/*printHomePage(15, 1, 90, 25);
	MainProgram(15);*/
	return 0;
}


/void CGAME::PlayGame() {
//	cg->drawGame();
//	axh = cg->getCars();
//	ad = cg->getBats();
//
//	//Line 1: Cars
//	int yCarLTR = 1;
//	int xCarLTR1 = 0;
//	int xCarLTROld1 = xCarLTR1;
//	int xCarLTR2 = 0;
//	int xCarLTROld2 = xCarLTR2;
//	int xCarLTR3 = 0;
//	int xCarLTROld3 = xCarLTR3;
//
//	//Line 2: Bats
//	int yBat = 6;
//	int xBat1 = 66;
//	int xBatOld1 = xBat1;
//	int xBat2 = 66;
//	int xBatOld2 = xBat2;
//	int xBat3 = 66;
//	int xBatOld3 = xBat3;
//
//	while (IS_RUNNING) {
//		//Line 1: Cars
//		if (xCarLTR1 == 70)
//			xCarLTR1 = 0;
//		if (xCarLTR2 == 70)
//			xCarLTR2 = 0;
//		if (xCarLTR3 == 70)
//			xCarLTR3 = 0;
//		//Line 2: Bats
//		if (xBat1 == 0)
//			xBat1 = 66;
//		if (xBat2 == 0)
//			xBat2 = 66;
//		if (xBat3 == 0)
//			xBat3 = 66;
//
//		DeleteImageOld(xCarLTROld1, yCarLTR, 10, 4);
//		axh[0].setX(xCarLTR1); axh[0].setY(yCarLTR);
//		xCarLTROld1 = xCarLTR1;
//		xCarLTR1 += 2;
//
//		//Bats
//		DeleteImageOld(xBatOld1, yBat, 13, 4);
//		ad[0].setX(xBat1); ad[0].setY(yBat);
//		xBatOld1 = xBat1;
//		xBat1 -= 2;
//
//		//Cars
//		if (xCarLTR1 >= 20 || xCarLTR2 >= 20) {
//			DeleteImageOld(xCarLTROld2, yCarLTR, 10, 4);
//			axh[1].setX(xCarLTR2); axh[1].setY(yCarLTR);
//			xCarLTROld2 = xCarLTR2;
//			xCarLTR2 += 2;
//		}
//		if (xCarLTR2 >= 20 || xCarLTR3 >= 20) {
//			DeleteImageOld(xCarLTROld3, yCarLTR, 10, 4);
//			axh[2].setX(xCarLTR3); axh[2].setY(yCarLTR);
//			xCarLTROld3 = xCarLTR3;
//			xCarLTR3 += 2;
//		}
//
//		//Bats
//		if (xBat1 <= 46 || xBat2 <= 46) {
//			DeleteImageOld(xBatOld2, yBat, 13, 4);
//			ad[1].setX(xBat2); ad[1].setY(yBat);
//			xBatOld2 = xBat2;
//			xBat2 -= 2;
//		}
//		if (xBat2 <= 46 || xBat3 <= 46) {
//			DeleteImageOld(xBatOld3, yBat, 13, 4);
//			ad[2].setX(xBat3); ad[2].setY(yBat);
//			xBatOld3 = xBat3;
//			xBat3 -= 2;
//		}
//
//		cg->updatePosVehicle();
//		cg->updatePosAnimal();
//		Sleep(200);
//	}
//}